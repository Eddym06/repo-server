<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoQuiz - Panel de Control</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>üéØ AutoQuiz</h1>
                <p>Panel de Control</p>
            </div>
            
            <nav class="nav">
                <button class="nav-item active" data-view="dashboard">
                    <span class="icon">üìä</span>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" data-view="users">
                    <span class="icon">üë•</span>
                    <span>Usuarios</span>
                </button>
                <button class="nav-item" data-view="errors">
                    <span class="icon">‚ö†Ô∏è</span>
                    <span>Errores</span>
                </button>
                <button class="nav-item" data-view="sessions">
                    <span class="icon">üìù</span>
                    <span>Sesiones</span>
                </button>
                <button class="nav-item" data-view="reports">
                    <span class="icon">üìä</span>
                    <span>Informes</span>
                </button>
            </nav>
            
            <div class="sidebar-footer">
                <div class="status">
                    <div class="status-indicator"></div>
                    <span>Servidor activo</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h2 id="page-title">Dashboard</h2>
                    <p id="page-subtitle">Estad√≠sticas generales del sistema</p>
                </div>
                <div class="header-right">
                    <button class="btn btn-primary" id="new-user-btn">
                        <span>‚ûï</span>
                        Nuevo Usuario
                    </button>
                    <button class="btn btn-secondary" id="refresh-btn">
                        <span>üîÑ</span>
                    </button>
                    <button class="btn btn-danger" id="logout-btn" title="Cerrar Sesi√≥n">
                        <span>üö™</span>
                    </button>
                </div>
            </header>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <p class="stat-label">Total Usuarios</p>
                            <h3 class="stat-value" id="stat-users">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <p class="stat-label">Cuestionarios Completados</p>
                            <h3 class="stat-value" id="stat-quizzes">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-info">
                            <p class="stat-label">Preguntas Procesadas</p>
                            <h3 class="stat-value" id="stat-questions">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ü™ô</div>
                        <div class="stat-info">
                            <p class="stat-label">Tokens Utilizados</p>
                            <h3 class="stat-value" id="stat-tokens">0</h3>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Actividad de Usuarios</h3>
                        <canvas id="activity-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Uso de Tokens</h3>
                        <canvas id="tokens-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>üìä Modelos M√°s Usados</h3>
                        <canvas id="models-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Users View -->
            <div id="users-view" class="view">
                <div class="users-list" id="users-list">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>

            <!-- Errors View -->
            <div id="errors-view" class="view">
                <div class="errors-list" id="errors-list">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>

            <!-- Sessions View -->
            <div id="sessions-view" class="view">
                <div class="sessions-list" id="sessions-list">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>

            <!-- Reports View -->
            <div id="reports-view" class="view">
                <div class="reports-header">
                    <div class="search-box">
                        <input type="text" id="reports-search" placeholder="üîç Buscar informes..." class="search-input">
                    </div>
                    <div class="filters">
                        <select id="reports-model-filter" class="filter-select">
                            <option value="">Todos los modelos</option>
                            <option value="gpt">OpenAI</option>
                            <option value="gemini">Google</option>
                            <option value="claude">Anthropic</option>
                            <option value="grok">xAI</option>
                            <option value="deepseek">DeepSeek</option>
                        </select>
                        <select id="reports-user-filter" class="filter-select">
                            <option value="">Todos los usuarios</option>
                        </select>
                    </div>
                </div>
                <div class="reports-list" id="reports-list">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modal: Nuevo Usuario -->
    <div id="new-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Crear Nuevo Usuario</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-username">Nombre Completo</label>
                    <input type="text" id="new-username" placeholder="Ej: Mar√≠a L√≥pez" required>
                </div>
                <div class="form-group">
                    <label for="favorite-model">Modelo Favorito (Opcional)</label>
                    <select id="favorite-model" class="form-select">
                        <option value="">Sin preferencia</option>
                        <option value="gpt-4o">GPT-4o (OpenAI)</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (OpenAI)</option>
                        <option value="gpt-5-mini">GPT-5 Mini (OpenAI)</option>
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash (Google)</option>
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash (Google)</option>
                        <option value="claude-haiku-4-5-20251015">Claude Haiku 4.5 (Anthropic)</option>
                        <option value="grok-2">Grok 2 (xAI)</option>
                        <option value="deepseek-chat">DeepSeek Chat</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-user-btn">Cancelar</button>
                <button class="btn btn-primary" id="create-user-btn">Crear Usuario</button>
            </div>
        </div>
    </div>

    <!-- Modal: Token Generado -->
    <div id="token-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úÖ Usuario Creado Exitosamente</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="token-info">
                    <p><strong>Usuario:</strong> <span id="created-username"></span></p>
                    <p><strong>Identificador:</strong> <code id="created-identifier"></code></p>
                    <div class="token-box">
                        <p><strong>Token de Autenticaci√≥n:</strong></p>
                        <div class="token-display">
                            <code id="created-token"></code>
                            <button class="btn-copy" id="copy-token-btn">üìã Copiar</button>
                        </div>
                    </div>
                    <div class="alert alert-warning">
                        ‚ö†Ô∏è <strong>Importante:</strong> Guarda este token. Solo se mostrar√° una vez.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="close-token-btn">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Modal: Detalles de Usuario -->
    <div id="user-detail-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üë§ <span id="detail-username"></span></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-section">
                        <h3>Informaci√≥n General</h3>
                        <p><strong>Identificador:</strong> <code id="detail-identifier"></code></p>
                        <p><strong>Estado:</strong> <span id="detail-status"></span></p>
                        <p><strong>Registrado:</strong> <span id="detail-created"></span></p>
                        <p><strong>√öltima actividad:</strong> <span id="detail-activity"></span></p>
                    </div>
                    <div class="detail-section">
                        <h3>M√©tricas</h3>
                        <p><strong>Cuestionarios completados:</strong> <span id="detail-quizzes"></span></p>
                        <p><strong>Preguntas procesadas:</strong> <span id="detail-questions"></span></p>
                        <p><strong>Tokens utilizados:</strong> <span id="detail-tokens"></span></p>
                        <p><strong>Errores totales:</strong> <span id="detail-errors"></span></p>
                    </div>
                </div>
                <div class="logs-section">
                    <h3>Logs en Tiempo Real</h3>
                    <div class="logs-container" id="user-logs">
                        <p class="logs-empty">Esperando actividad...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="open-console-btn">üñ•Ô∏è Abrir Consola</button>
                <button class="btn btn-danger" id="delete-user-btn">üóëÔ∏è Eliminar Usuario</button>
                <button class="btn btn-secondary" id="toggle-user-btn">üîÑ Inhabilitar</button>
                <button class="btn btn-primary modal-close">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Consola en Tiempo Real -->
    <div id="console-modal" class="modal">
        <div class="modal-content modal-xlarge">
            <div class="modal-header">
                <div class="console-header-left">
                    <h2>üñ•Ô∏è Consola de Logs</h2>
                    <span class="console-user-label" id="console-user-label">Usuario: <code id="console-username">-</code></span>
                </div>
                <div class="console-header-right">
                    <button class="btn btn-sm btn-success" id="console-start-btn">‚ñ∂Ô∏è Iniciar</button>
                    <button class="btn btn-sm btn-danger" id="console-stop-btn" disabled>‚è∏Ô∏è Pausar</button>
                    <button class="btn btn-sm btn-secondary" id="console-clear-btn">üóëÔ∏è Limpiar</button>
                    <button class="modal-close">&times;</button>
                </div>
            </div>
            <div class="modal-body console-body">
                <div class="console-filters">
                    <label class="filter-label">Filtros:</label>
                    <button class="filter-btn active" data-level="all">Todos</button>
                    <button class="filter-btn" data-level="INFO">INFO</button>
                    <button class="filter-btn" data-level="WARN">WARN</button>
                    <button class="filter-btn" data-level="ERROR">ERROR</button>
                    <button class="filter-btn" data-level="DEBUG">DEBUG</button>
                    <div class="console-status">
                        <span class="status-indicator" id="console-status-indicator"></span>
                        <span id="console-status-text">Desconectado</span>
                    </div>
                </div>
                <div class="console-output" id="console-output">
                    <div class="console-welcome">
                        <p>üñ•Ô∏è <strong>Consola de Logs en Tiempo Real</strong></p>
                        <p>Presiona <strong>"Iniciar"</strong> para comenzar a recibir logs de la extensi√≥n del usuario.</p>
                        <p>Los logs aparecer√°n aqu√≠ en tiempo real mientras el usuario utiliza AutoQuiz.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="console-info">
                    <span>L√≠neas: <strong id="console-line-count">0</strong></span>
                    <span>√öltima actualizaci√≥n: <strong id="console-last-update">-</strong></span>
                </div>
                <button class="btn btn-primary modal-close">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
